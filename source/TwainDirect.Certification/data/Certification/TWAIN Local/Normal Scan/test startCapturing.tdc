;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
; Test startCapturing
; Exercise the startCapturing command.  We're going to do the following:
; - confirm that startCapturing, and contains all required properties
; - confirm that startCapturing reports invalidState now
;
; Arguments
; (none)
;
; Locals
; startcapturingresult - result of the test
;
; returns: pass or fail
;



;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
; Display the banner...
;
echo
echo 'Test startCapturing v1.0 17-Jul-2017'
set startcapturingresult 'pass'



;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
; Check the codes, we're looking for commands that must return busy and invalidState
;
run 'function CheckCode' 'startcapturingresult' 'createSession' 'busy'
run 'function CheckCode' 'startcapturingresult' 'readImageBlockMetadata' 'invalidState' '1' 'false'
run 'function CheckCode' 'startcapturingresult' 'readImageBlock' 'invalidState' '1' 'false'
run 'function CheckCode' 'startcapturingresult' 'releaseImageBlocks' 'invalidState' '1' '1'
run 'function CheckCode' 'startcapturingresult' 'stopCapturing' 'invalidState'



;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
; Call startCapturing, and check the return properties...
;
call STARTCAPTURING



;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
; Check the codes, we're looking for commands that must return busy and invalidState
;
run 'function CheckCode' 'startcapturingresult' 'createSession' 'busy'
run 'function CheckCode' 'startcapturingresult' 'startCapturing' 'invalidState'



;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
; Bye-bye...
;
echopassfail 'SUMMARY' '${get:startcapturingresult}'
return '${get:startcapturingresult}'



;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
; STARTCAPTURING
; returns pass or fail
;
:STARTCAPTURING
;
; Send the command...
startCapturing
;
; Check the headers...
run 'function CheckHeader' 'startcapturingresult' 'Content-Type' ~contains 'application/json' 'charset=utf-8'
run 'function CheckHeader' 'startcapturingresult' 'Content-Length' == '${rdata:#}'
;
; Check the mandatory properties...
run 'function CheckJsonProperty' 'startcapturingresult' 'kind' == 'twainlocalscanner'
run 'function CheckJsonProperty' 'startcapturingresult' 'commandId'
run 'function CheckJsonProperty' 'startcapturingresult' 'method' == 'startCapturing'
run 'function CheckJsonProperty' 'startcapturingresult' 'results'
run 'function CheckJsonProperty' 'startcapturingresult' 'results.success' == 'true'
run 'function CheckJsonProperty' 'startcapturingresult' 'results.session'
run 'function CheckJsonProperty' 'startcapturingresult' 'results.session.sessionId' != ''
run 'function CheckJsonProperty' 'startcapturingresult' 'results.session.revision' != ''
run 'function CheckJsonProperty' 'startcapturingresult' 'results.session.state' == 'capturing'
if '${get:startcapturingresult}' != 'pass' goto STARTCAPTURING.FAIL
;
; We're good...
echopassfail 'startCapturing call' 'pass'
return 'pass'
;
:STARTCAPTURING.FAIL
echopassfail 'startCapturing call' 'fail'
return 'fail'
