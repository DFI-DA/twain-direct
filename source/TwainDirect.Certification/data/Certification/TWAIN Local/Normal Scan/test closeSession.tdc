;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
; Test closeSession
; Exercise the closeSession command.  We're going to do the following:
; - confirm that closeSession succeeds, and contains all required properties
;
; Arguments
; arg:1 - state to check for
;
; Locals
; closesessionresult - result of the test
;
; returns: pass or fail
;



;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
; Display the banner...
;
echo
echo 'Test closeSession v1.0 21-Jul-2017'
set closesessionresult 'pass'



;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
; Call closeSession, and check the return properties...
;
call CLOSESESSION '${arg:1}'



;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
; Bye-bye...
;
echopassfail 'SUMMARY' '${get:closesessionresult}'
return '${get:closesessionresult}'



;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
; CLOSESESSION
; arg:1 - state to check for
; returns pass or fail
;
:CLOSESESSION
;
; Send the command...
closeSession
;
; Check the headers...
run 'function CheckHeader' 'TL.NSCN.CLSS.001' 'closesessionresult' 'Content-Type' ~contains 'application/json' 'charset=utf-8'
run 'function CheckHeader' 'TL.NSCN.CLSS.002' 'closesessionresult' 'Content-Length' == '${rdata:#}'
;
; Check the mandatory properties...
run 'function CheckJsonProperty' 'TL.NSCN.CLSS.003' 'closesessionresult' 'kind' == 'twainlocalscanner'
run 'function CheckJsonProperty' 'TL.NSCN.CLSS.004' 'closesessionresult' 'commandId'
run 'function CheckJsonProperty' 'TL.NSCN.CLSS.005' 'closesessionresult' 'method' == 'closeSession'
run 'function CheckJsonProperty' 'TL.NSCN.CLSS.006' 'closesessionresult' 'results'
run 'function CheckJsonProperty' 'TL.NSCN.CLSS.007' 'closesessionresult' 'results.success' == 'true'
run 'function CheckJsonProperty' 'TL.NSCN.CLSS.008' 'closesessionresult' 'results.session'
run 'function CheckJsonProperty' 'TL.NSCN.CLSS.009' 'closesessionresult' 'results.session.sessionId' != ''
run 'function CheckJsonProperty' 'TL.NSCN.CLSS.010' 'closesessionresult' 'results.session.revision' != ''
run 'function CheckJsonProperty' 'TL.NSCN.CLSS.011' 'closesessionresult' 'results.session.state' == '${arg:1}'
if '${get:closesessionresult}' != 'pass' goto CLOSESESSION.FAIL
;
; We're good...
return 'pass'
;
; No joy...
:CLOSESESSION.FAIL
set closesessionresult 'fail'
return 'fail'
